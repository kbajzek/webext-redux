!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).WebextRedux={})}(this,(function(e){"use strict";function t(e,t,r,n,o,i,a){try{var s=e[i](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function r(e){return function(){var r=this,n=arguments;return new Promise((function(o,i){var a=e.apply(r,n);function s(e){t(a,o,i,s,u,"next",e)}function u(e){t(a,o,i,s,u,"throw",e)}s(void 0)}))}}function n(e,t){for(var r=0;t.length>r;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e){for(var t=1;arguments.length>t;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){o(e,t,r[t])}))}return e}function a(e){return function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);e.length>t;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var s=9007199254740991,u="[object Arguments]",c="[object Function]",l="[object GeneratorFunction]",f=/^(?:0|[1-9]\d*)$/;function d(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var p=Object.prototype,h=p.hasOwnProperty,v=p.toString,y=p.propertyIsEnumerable,g=Math.max;function m(e,t){var r=j(e)||function(e){return function(e){return function(e){return!!e&&"object"==typeof e}(e)&&A(e)}(e)&&h.call(e,"callee")&&(!y.call(e,"callee")||v.call(e)==u)}(e)?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],n=r.length,o=!!n;for(var i in e)!t&&!h.call(e,i)||o&&("length"==i||x(i,n))||r.push(i);return r}function b(e,t,r){var n=e[t];h.call(e,t)&&S(n,r)&&(void 0!==r||t in e)||(e[t]=r)}function w(e){if(!O(e))return function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}(e);var t,r,n=(t=e)===("function"==typeof(r=t&&t.constructor)&&r.prototype||p),o=[];for(var i in e)("constructor"!=i||!n&&h.call(e,i))&&o.push(i);return o}function x(e,t){return!!(t=null==t?s:t)&&("number"==typeof e||f.test(e))&&e>-1&&e%1==0&&t>e}function S(e,t){return e===t||e!=e&&t!=t}var E,P,k,j=Array.isArray;function A(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&s>=e}(e.length)&&!function(e){var t=O(e)?v.call(e):"";return t==c||t==l}(e)}function O(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}var z=(E=function(e,t){!function(e,t,r,n){r||(r={});for(var o=-1,i=t.length;++o<i;){var a=t[o],s=n?n(r[a],e[a],a,r,e):void 0;b(r,a,void 0===s?e[a]:s)}}(t,function(e){return A(e)?m(e,!0):w(e)}(t),e)},P=function(e,t){var r=-1,n=t.length,o=n>1?t[n-1]:void 0,i=n>2?t[2]:void 0;for(o=E.length>3&&"function"==typeof o?(n--,o):void 0,i&&function(e,t,r){if(!O(r))return!1;var n=typeof t;return!!("number"==n?A(r)&&x(t,r.length):"string"==n&&t in r)&&S(r[t],e)}(t[0],t[1],i)&&(o=3>n?void 0:o,n=1),e=Object(e);++r<n;){var a=t[r];a&&E(e,a,r,o)}return e},k=g(void 0===k?P.length-1:k,0),function(){for(var e=arguments,t=-1,r=g(e.length-k,0),n=Array(r);++t<r;)n[t]=e[k+t];t=-1;for(var o=Array(k+1);++t<k;)o[t]=e[t];return o[k]=n,d(P,this,o)}),R="chromex.state",M="chromex.patch_state",N=function(e){return e},I=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:N;return i({},e,e.payload?{payload:t(e.payload)}:{})},L=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:N,r=arguments.length>2?arguments[2]:void 0;return r?function(n){for(var o=arguments.length,i=Array(o>1?o-1:0),a=1;o>a;a++)i[a-1]=arguments[a];return r.apply(void 0,[n].concat(i))?e.apply(void 0,[I(n,t)].concat(i)):e.apply(void 0,[n].concat(i))}:function(r){for(var n=arguments.length,o=Array(n>1?n-1:0),i=1;n>i;i++)o[i-1]=arguments[i];return e.apply(void 0,[I(r,t)].concat(o))}},_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N;return function(t){return function(r,n){return t(L(r,e,n))}}},C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N;return function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return function(){for(var n=arguments.length,o=Array(n),i=0;n>i;i++)o[i]=arguments[i];if(r>=o.length)throw Error("Message in request could not be serialized. "+"Expected message in position ".concat(r," but only received ").concat(o.length," args."));return o[r]=I(o[r],e),t.apply(void 0,o)}}},H="updated",q="removed";function D(){var e;try{e=self.chrome||self.browser||browser}catch(t){e=browser}if(!e)throw Error("Browser API is not present");return e}var F={portName:"chromex.port_name",state:{},extensionId:null,serializer:N,deserializer:N,patchStrategy:function(e,t){var r=Object.assign({},e);return t.forEach((function(e){var t=e.key,n=e.value;switch(e.change){case H:r[t]=n;break;case q:Reflect.deleteProperty(r,t)}})),r}};function T(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}var B={portName:"chromex.port_name",dispatchResponder:function(e,t){Promise.resolve(e).then((function(e){t({error:null,value:e})})).catch((function(e){console.error("error dispatching result:",e),t({error:e.message,value:null})}))},serializer:N,deserializer:N,diffStrategy:function(e,t){var r=[];return Object.keys(t).forEach((function(n){e[n]!==t[n]&&r.push({key:n,value:t[n],change:H})})),Object.keys(e).forEach((function(e){t.hasOwnProperty(e)||r.push({key:e,change:q})})),r}};e.Store=function(){function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F,n=r.portName,o=void 0===n?F.portName:n,i=r.state,a=void 0===i?F.state:i,s=r.extensionId,u=void 0===s?F.extensionId:s,c=r.serializer,l=void 0===c?F.serializer:c,f=r.deserializer,d=void 0===f?F.deserializer:f,p=r.patchStrategy,h=void 0===p?F.patchStrategy:p,v=r.store;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!o)throw Error("portName is required in options");if("function"!=typeof l)throw Error("serializer must be a function");if("function"!=typeof d)throw Error("deserializer must be a function");if("function"!=typeof h)throw Error("patchStrategy must be one of the included patching strategies or a custom patching function");this.portName=o,this.readyResolved=!1,this.readyPromise=new Promise((function(e){return t.readyResolve=e})),this.browserAPI=D(),this.extensionId=u,this.port=this.browserAPI.runtime.connect(this.extensionId,{name:o}),this.safetyHandler=this.safetyHandler.bind(this),this.browserAPI.runtime.onMessage&&(this.safetyMessage=this.browserAPI.runtime.onMessage.addListener(this.safetyHandler)),this.serializedPortListener=_(d)((function(){var e;return(e=t.port.onMessage).addListener.apply(e,arguments)})),this.serializedMessageSender=C(l)((function(){var e;return(e=t.browserAPI.runtime).sendMessage.apply(e,arguments)}),1),this.listeners=[],this.state=a,this.patchStrategy=h,v&&(this.store=v),this.serializedPortListener((function(e){switch(e.type){case R:t.replaceState(e.payload),t.readyResolved||(t.readyResolved=!0,t.readyResolve());break;case M:t.patchState(e.payload)}})),this.dispatch=this.dispatch.bind(this)}var t,r,o;return t=e,(r=[{key:"ready",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null!==e?this.readyPromise.then(e):this.readyPromise}},{key:"subscribe",value:function(e){var t=this;return this.store?this.store.subscribe(e):(this.listeners.push(e),function(){t.listeners=t.listeners.filter((function(t){return t!==e}))})}},{key:"patchState",value:function(e){this.store||(this.state=this.patchStrategy(this.state,e),this.listeners.forEach((function(e){return e()})))}},{key:"replaceState",value:function(e){this.store||(this.state=e,this.listeners.forEach((function(e){return e()})))}},{key:"getState",value:function(){return this.store?this.store.state:this.state}},{key:"replaceReducer",value:function(){}},{key:"dispatch",value:function(e){var t=this;return new Promise((function(r,n){t.serializedMessageSender(t.extensionId,{type:"chromex.dispatch",portName:t.portName,payload:e},null,(function(e){var t=e.error,o=e.value;if(t){var i=Error("".concat("\nLooks like there is an error in the background page. You might want to inspect your background page for more details.\n").concat(t));n(z(i,t))}else r(o&&o.payload)}))}))}},{key:"safetyHandler",value:function(e){"storeReady"===e.action&&e.portName===this.portName&&(this.browserAPI.runtime.onMessage.removeListener(this.safetyHandler),this.readyResolved||(this.readyResolved=!0,this.readyResolve()))}}])&&n(t.prototype,r),o&&n(t,o),e}(),e.alias=function(e){return function(){return function(t){return function(r){var n=e[r.type];return t(n?n(r):r)}}}},e.applyMiddleware=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;t>n;n++)r[n-1]=arguments[n];var o=function(){throw Error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},i={getState:e.getState.bind(e),dispatch:function(){return o.apply(void 0,arguments)}};return r=(r||[]).map((function(e){return e(i)})),o=T.apply(void 0,a(r))(e.dispatch),e.dispatch=o,e},e.wrapStore=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B,n=t.portName,o=void 0===n?B.portName:n,i=t.dispatchResponder,a=void 0===i?B.dispatchResponder:i,s=t.serializer,u=void 0===s?B.serializer:s,c=t.deserializer,l=void 0===c?B.deserializer:c,f=t.diffStrategy,d=void 0===f?B.diffStrategy:f;if(!o)throw Error("portName is required in options");if("function"!=typeof u)throw Error("serializer must be a function");if("function"!=typeof l)throw Error("deserializer must be a function");if("function"!=typeof d)throw Error("diffStrategy must be one of the included diffing strategies or a custom diff function");var p=D(),h=function(){var t=r(regeneratorRuntime.mark((function t(r,n,i){var s,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("chromex.dispatch"!==r.type||r.portName!==o){t.next=16;break}return s=Object.assign({},r.payload,{_sender:n}),u=null,t.prev=3,t.next=6,e();case 6:t.t0=s,u=t.sent.dispatch(t.t0),t.next=14;break;case 10:t.prev=10,t.t1=t.catch(3),u=Promise.reject(t.t1.message),console.error(t.t1);case 14:return a(u,i),t.abrupt("return",!0);case 16:case"end":return t.stop()}}),t,this,[[3,10]])})));return function(e,r,n){return t.apply(this,arguments)}}(),v=function(){var t=r(regeneratorRuntime.mark((function t(r){var n,i,a,s,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e();case 2:if(n=t.sent,r.name===o){t.next=5;break}return t.abrupt("return");case 5:return i=C(u)((function(){return r.postMessage.apply(r,arguments)})),a=n.getState(),s=function(){var e=n.getState(),t=d(a,e);t.length&&(a=e,i({type:M,payload:t}))},t.next=10,e();case 10:t.t0=s,c=t.sent.subscribe(t.t0),r.onDisconnect.addListener(c),i({type:R,payload:a});case 14:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),y=_(l),g=function(e){return"chromex.dispatch"===e.type&&e.portName===o};y((function(){var e;return(e=p.runtime.onMessage).addListener.apply(e,arguments)}))(h,g),p.runtime.onMessageExternal?y((function(){var e;return(e=p.runtime.onMessageExternal).addListener.apply(e,arguments)}))(h,g):console.warn("runtime.onMessageExternal is not supported"),p.runtime.onConnect.addListener(v),p.runtime.onConnectExternal?p.runtime.onConnectExternal.addListener(v):console.warn("runtime.onConnectExternal is not supported"),p.tabs.query({},(function(e){var t=!0,r=!1,n=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){p.tabs.sendMessage(i.value.id,{action:"storeReady",portName:o},(function(){chrome}))}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}}))},Object.defineProperty(e,"__esModule",{value:!0})}));
